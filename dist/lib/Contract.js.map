{"version":3,"file":"Contract.js","names":["_abi","require","Contract","abi","address","nod3","Error","contractInterface","Interface","at","newAddress","setNod3","nod3Instance","encodeCall","methodName","params","encodeFunctionData","decodeCall","data","outputs","getFunction","decoded","decodeFunctionResult","Array","isArray","length","call","txData","to","tx","Object","assign","result","eth","err","Promise","reject","freeze"],"sources":["../../src/lib/Contract.js"],"sourcesContent":["import { Interface } from '@ethersproject/abi'\n\nexport default function Contract (abi, { address, nod3 } = {}) {\n  if (!abi || typeof abi !== 'object') throw new Error('Invalid abi')\n  const contractInterface = new Interface(abi)\n\n  const at = newAddress => {\n    address = newAddress\n  }\n\n  const setNod3 = nod3Instance => {\n    nod3 = nod3Instance\n  }\n\n  // const isEvent = name => abiFind('event', name)\n\n  const encodeCall = (methodName, params = []) => contractInterface.encodeFunctionData(methodName, params)\n\n  const decodeCall = (methodName, data) => {\n    const { outputs } = contractInterface.getFunction(methodName)\n    const decoded = contractInterface.decodeFunctionResult(methodName, data)\n    return (Array.isArray(decoded) && outputs && outputs.length < 2) ? decoded[0] : decoded\n  }\n\n  const call = async (methodName, params = [], txData = {}) => {\n    try {\n      if (!nod3) throw new Error(`Set nod3 instance before call`)\n      if (!address) throw new Error(`The contract address is not defined`)\n      if (!Array.isArray(params)) throw new Error(`Params must be an array`)\n      const data = encodeCall(methodName, params)\n      const to = address\n      const tx = Object.assign(txData, { to, data })\n      const result = await nod3.eth.call(tx)\n      return decodeCall(methodName, result)\n    } catch (err) {\n      return Promise.reject(err)\n    }\n  }\n  return Object.freeze({ at, setNod3, encodeCall, decodeCall, call })\n}\n"],"mappings":"sGAAA,IAAAA,IAAA,GAAAC,OAAA;;AAEe,SAASC,QAAQA,CAAEC,GAAG,EAAE,EAAEC,OAAO,EAAEC,IAAI,CAAC,CAAC,GAAG,CAAC,CAAC,EAAE;EAC7D,IAAI,CAACF,GAAG,IAAI,OAAOA,GAAG,KAAK,QAAQ,EAAE,MAAM,IAAIG,KAAK,CAAC,aAAa,CAAC;EACnE,MAAMC,iBAAiB,GAAG,IAAIC,cAAS,CAACL,GAAG,CAAC;;EAE5C,MAAMM,EAAE,GAAGA,CAAAC,UAAU,KAAI;IACvBN,OAAO,GAAGM,UAAU;EACtB,CAAC;;EAED,MAAMC,OAAO,GAAGA,CAAAC,YAAY,KAAI;IAC9BP,IAAI,GAAGO,YAAY;EACrB,CAAC;;EAED;;EAEA,MAAMC,UAAU,GAAGA,CAACC,UAAU,EAAEC,MAAM,GAAG,EAAE,KAAKR,iBAAiB,CAACS,kBAAkB,CAACF,UAAU,EAAEC,MAAM,CAAC;;EAExG,MAAME,UAAU,GAAGA,CAACH,UAAU,EAAEI,IAAI,KAAK;IACvC,MAAM,EAAEC,OAAO,CAAC,CAAC,GAAGZ,iBAAiB,CAACa,WAAW,CAACN,UAAU,CAAC;IAC7D,MAAMO,OAAO,GAAGd,iBAAiB,CAACe,oBAAoB,CAACR,UAAU,EAAEI,IAAI,CAAC;IACxE,OAAQK,KAAK,CAACC,OAAO,CAACH,OAAO,CAAC,IAAIF,OAAO,IAAIA,OAAO,CAACM,MAAM,GAAG,CAAC,GAAIJ,OAAO,CAAC,CAAC,CAAC,GAAGA,OAAO;EACzF,CAAC;;EAED,MAAMK,IAAI,GAAG,MAAAA,CAAOZ,UAAU,EAAEC,MAAM,GAAG,EAAE,EAAEY,MAAM,GAAG,CAAC,CAAC,KAAK;IAC3D,IAAI;MACF,IAAI,CAACtB,IAAI,EAAE,MAAM,IAAIC,KAAK,CAAE,+BAA8B,CAAC;MAC3D,IAAI,CAACF,OAAO,EAAE,MAAM,IAAIE,KAAK,CAAE,qCAAoC,CAAC;MACpE,IAAI,CAACiB,KAAK,CAACC,OAAO,CAACT,MAAM,CAAC,EAAE,MAAM,IAAIT,KAAK,CAAE,yBAAwB,CAAC;MACtE,MAAMY,IAAI,GAAGL,UAAU,CAACC,UAAU,EAAEC,MAAM,CAAC;MAC3C,MAAMa,EAAE,GAAGxB,OAAO;MAClB,MAAMyB,EAAE,GAAGC,MAAM,CAACC,MAAM,CAACJ,MAAM,EAAE,EAAEC,EAAE,EAAEV,IAAI,CAAC,CAAC,CAAC;MAC9C,MAAMc,MAAM,GAAG,MAAM3B,IAAI,CAAC4B,GAAG,CAACP,IAAI,CAACG,EAAE,CAAC;MACtC,OAAOZ,UAAU,CAACH,UAAU,EAAEkB,MAAM,CAAC;IACvC,CAAC,CAAC,OAAOE,GAAG,EAAE;MACZ,OAAOC,OAAO,CAACC,MAAM,CAACF,GAAG,CAAC;IAC5B;EACF,CAAC;EACD,OAAOJ,MAAM,CAACO,MAAM,CAAC,EAAE5B,EAAE,EAAEE,OAAO,EAAEE,UAAU,EAAEI,UAAU,EAAES,IAAI,CAAC,CAAC,CAAC;AACrE"}